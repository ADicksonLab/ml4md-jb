
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Week 06 Lecture: Molecular Dynamics Concepts 1 &#8212; Machine Learning for Molecular Dynamics</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/ml4md_fav.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Week 06 Lab: Single Particle Langevin Dynamics" href="W6_Lab_Single-Particle-Langevin-Dynamics.html" />
    <link rel="prev" title="Week 05 Lab: Structure Prediction" href="../Week-05/W5_Lab_StructurePrediction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning for Molecular Dynamics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to Machine Learning for Molecular Dynamics - BMB 961 Sec 003
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Materials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Course_Materials/BMB961-003_Syllabus.html">
   Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Course_Materials/BMB961-003_Schedule.html">
   Course Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Course_Materials/SoftwareSetupGuide.html">
   Software Setup Guide
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 01
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-01/W1_Lecture_Welcome.html">
   Week 01 Lecture: Welcome to ML4MD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-01/W1_Lab_Python_Refresher.html">
   Week 01 Lab: Python Refresher Course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Course_Materials/learn_python.zip">
   LearnPython.zip
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/blob/8bc6b5d18b4f72c40ad50704cb6507c58f7f595c/Course_Materials/BMB_Community_Standards.pdf">
   BMB_Community_Standards.pdf
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://raw.githubusercontent.com/ADicksonLab/ml4md-jb/main/Week-01/sEH_nowater.pdb">
   sEH_nowater.pdb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-01/sEH_unbinding.dcd">
   sEH_unbinding.dcd
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 02
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-02/W2_Lecture_MLBasics.html">
   Week 02 Lecture: Machine Learning at the Intersection with Molecular Simulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-02/W2_Lab_MLBasics.html">
   Week 02 Lab: Machine Learning Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-02/apple.vacuum.dat">
   apple.vacuum.dat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-02/apple.vacuum.highres.dat">
   apple.vacuum.highres.dat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-02/apple.leaf.air.highres.dat">
   apple.leaf.air.highres.dat
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 03
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-03/W3_Lecture_NNArchitectures.html">
   Week 03 Lecture: Neural Network Architectures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-03/W3_Lab_ConvNetworks.html">
   Week 03 Lab: Convolutional Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-03/aq15_pdbs.tgz">
   aq15_pdbs.tgz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-03/aq15.rgyr.dat">
   aq15.rgyr.dat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-03/aq15.pb.dat">
   aq15.pb.dat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-03/aq15.gb.dat">
   aq15.gb.dat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-03/aq15.sasa.dat">
   aq15.sasa.dat
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 04
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-04/W4_Lecture_GenerativeModels.html">
   Week 04 Lecture: Generating things with ML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-04/W4_Lab_GenerateMolecularConformations.html">
   Week 04 Lab: Generating Molecular Conformations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 05
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-05/W5_Lecture-ProteinStructurePrediction.html">
   Week 05 Lecture: Protein Structure Prediction in the Age of Artificial Intelligence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-05/W5_Lab_StructurePrediction.html">
   Week 05 Lab: Structure Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/raw/main/Week-05/work7efy.zip">
   work7efy.zip
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 06
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Week 06 Lecture: Molecular Dynamics Concepts 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="W6_Lab_Single-Particle-Langevin-Dynamics.html">
   Week 06 Lab: Single Particle Langevin Dynamics
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 07
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-07/W7_Lecture_MD-Concepts2.html">
   Week 07 Lecture: Molecular Dynamics Concepts 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-07/W7_Lab_Liquid-Argon-Simulation.html">
   Week 07 Lab: Liquid Argon Simulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/blob/main/Week-07/traj_pos_T50.npy?raw=true">
   traj_pos_T50.npy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/blob/main/Week-07/traj_vel_T50.npy?raw=true">
   traj_vel_T50.npy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/blob/main/Week-07/traj_pos_T80.npy?raw=true">
   traj_pos_T80.npy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/blob/main/Week-07/traj_pos_T120.npy?raw=true">
   traj_pos_T120.npy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/ADicksonLab/ml4md-jb/blob/main/Week-07/traj_pos_T200.npy?raw=true">
   traj_pos_T200.npy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 08
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-08/W8_Lecture-Biomolecular-Simulation-1.html">
   Week 8 Lecture: Biomolecular Simulation (Part I)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://raw.githubusercontent.com/ADicksonLab/ml4md-jb/main/Week-08/input.pdb">
   input.pdb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://raw.githubusercontent.com/ADicksonLab/ml4md-jb/main/Week-08/water.pdb">
   water.pdb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-08/W8_Lab-Angiotensin-Simulation.html">
   Biomolecular Simulation (Lab 1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://raw.githubusercontent.com/ADicksonLab/ml4md-jb/main/Week-08/angiotensin.pdb">
   angiotensin.pdb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week-08/software.html">
   Commands to install openmm in Colab
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Week-06/W6_Lecture_MD-Concepts1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ADicksonLab/ml4md-jb"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ADicksonLab/ml4md-jb/issues/new?title=Issue%20on%20page%20%2FWeek-06/W6_Lecture_MD-Concepts1.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ADicksonLab/ml4md-jb/main?urlpath=tree/Week-06/W6_Lecture_MD-Concepts1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/ADicksonLab/ml4md-jb/blob/main/Week-06/W6_Lecture_MD-Concepts1.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#st-century-computing-using-18th-century-physics">
   21st century computing using 18th century physics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem">
   The problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-hamiltonian">
   The Hamiltonian
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-hamiltonian-to-evolve-the-system">
   Using the Hamiltonian to evolve the system
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#net-forces">
   Net forces
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gaining-intuition-about-du-dx">
   Gaining intuition about dU/dx
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integrators-numerically-solving-hamilton-s-equations">
   Integrators:  Numerically solving Hamilton’s equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-example">
   An example:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-better-integration-function">
   A better integration function
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#on-the-reversibility-of-trajectories">
   On the reversibility of trajectories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-aside-on-chaos">
   An aside on chaos
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introducing-randomness-with-langevin-dynamics">
   Introducing randomness with Langevin dynamics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#constant-temperature-or-constant-energy-but-not-both">
   Constant temperature or constant energy, but not both
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="week-06-lecture-molecular-dynamics-concepts-1">
<h1>Week 06 Lecture: Molecular Dynamics Concepts 1<a class="headerlink" href="#week-06-lecture-molecular-dynamics-concepts-1" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Hamiltonian mechanics</p></li>
<li><p>kinetic and potential energy</p></li>
<li><p>integrating equations of motion</p></li>
<li><p>reversibility</p></li>
<li><p>randomness</p></li>
</ul>
<div class="section" id="st-century-computing-using-18th-century-physics">
<h2>21st century computing using 18th century physics<a class="headerlink" href="#st-century-computing-using-18th-century-physics" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><img src="https://cdn.pixabay.com/photo/2019/01/16/20/26/isaac-newton-3936704_1280.png" width="300"></img></p></th>
<th class="text-align:center head"><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Euler_1778.jpg/1014px-Euler_1778.jpg?20181213194654" width="300"></img></p></th>
<th class="text-align:center head"><p><img src="https://upload.wikimedia.org/wikipedia/commons/4/46/%D0%9B%D0%B0%D0%B3%D1%80%D0%B0%D0%BD%D0%B6.jpg" width="300"></img></p></th>
<th class="text-align:center head"><p><img src="https://upload.wikimedia.org/wikipedia/commons/f/f6/William_Rowan_Hamilton_portrait_oval_combined.png" width="300"></img></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Isaac Newton (1643-1727)</p></td>
<td class="text-align:center"><p>Leonard Euler (1707-1783)</p></td>
<td class="text-align:center"><p>Joseph-Louis Lagrange (1736-1813)</p></td>
<td class="text-align:center"><p>William Rowan Hamilton (1805-1865)</p></td>
</tr>
</tbody>
</table>
<p>The molecular dynamics technique is built on a branch of Classical Mechanics called “Hamiltonian Mechanics”.  For our purposes we will only need some basic calculus.  Today we’ll review the necessary concepts.</p>
<p>For additional materials here, check out:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Hamiltonian_mechanics">Wikipedia: Hamiltonian Mechanics</a></p></li>
</ul>
</div>
<div class="section" id="the-problem">
<h2>The problem<a class="headerlink" href="#the-problem" title="Permalink to this headline">¶</a></h2>
<p>Imagine we have a collection of objects, where their <strong>positions</strong> are denoted with (<span class="math notranslate nohighlight">\(\overrightarrow{x}\)</span>) and their <strong>velocities</strong> are denoted with (<span class="math notranslate nohighlight">\(\overrightarrow{v}\)</span>).  Each of these are vectors, where the number of elements is equal to the number of particles times the number of spatial dimensions.  Let’s say we are working in 3-D space, with <span class="math notranslate nohighlight">\(N\)</span> objects, so <span class="math notranslate nohighlight">\(\overrightarrow{x}\)</span> and <span class="math notranslate nohighlight">\(\overrightarrow{v}\)</span> will have size <span class="math notranslate nohighlight">\(3N\)</span>.</p>
<p>We can denote the <strong>mass</strong> of the objects by <span class="math notranslate nohighlight">\(\overrightarrow{m}\)</span>, which is a vector of size <span class="math notranslate nohighlight">\(N\)</span>.</p>
<p><em>Note on notation:  This notebook is using (x,v) notation, but you might also come across resources using (q,p) to denote the positions and momenta, respectively. We will try and keep (x,v) notation consistent throughout these course materials.</em></p>
<p><strong>The goal:</strong> If we know the initial conditions of the <span class="math notranslate nohighlight">\(\overrightarrow{x}\)</span> and <span class="math notranslate nohighlight">\(\overrightarrow{v}\)</span> vectors at some initial time <span class="math notranslate nohighlight">\(t_0\)</span>, how do we calculate the values of <span class="math notranslate nohighlight">\(\overrightarrow{x}\)</span> and <span class="math notranslate nohighlight">\(\overrightarrow{v}\)</span> in the future?</p>
</div>
<div class="section" id="the-hamiltonian">
<h2>The Hamiltonian<a class="headerlink" href="#the-hamiltonian" title="Permalink to this headline">¶</a></h2>
<p>Obviously to accomplish this goal we are going to need information about how what these particles are and how they interact with each other. This can be accomplished using a single function called the <strong>Hamiltonian</strong>:</p>
<p>\begin{equation}
\mathscr{H}(x,v) = U(x) + T(v)
\end{equation}</p>
<p>where <span class="math notranslate nohighlight">\(U(x)\)</span> is the potential energy function (also called the “internal energy” function) that depends only on the particle positions and <span class="math notranslate nohighlight">\(T(v)\)</span> is the kinetic energy function that depends only on the velocities.</p>
<p>While the particular form of <span class="math notranslate nohighlight">\(U(x)\)</span> can be complicated, and is different from system-to-system, the kinetic energy function is simply defined as:</p>
<p>\begin{equation}
T(v) = \frac{1}{2}\sum_i m_i |v_i|^2
\end{equation}</p>
<p>where <span class="math notranslate nohighlight">\(\sum_i\)</span> is a sum over all of the particles in the system.</p>
</div>
<div class="section" id="using-the-hamiltonian-to-evolve-the-system">
<h2>Using the Hamiltonian to evolve the system<a class="headerlink" href="#using-the-hamiltonian-to-evolve-the-system" title="Permalink to this headline">¶</a></h2>
<p>The evolution of the system is then described completely by <strong>Hamilton’s equations</strong>.
A simplified version of these is given below.</p>
<p>\begin{align}
\frac{dx}{dt} &amp;= \frac{1}{m}\frac{d\mathscr{H}}{dv} = v \
\frac{dv}{dt} &amp;= -\frac{1}{m}\frac{d\mathscr{H}}{dx} = -\frac{1}{m}\frac{dU}{dx}
\end{align}</p>
<p>where the <span class="math notranslate nohighlight">\(1/m\)</span> factors are necessary since we were dealing with the velocity instead of the momentum.</p>
<p>The top equation above is intuitive: <strong>the rate of change of the positions is given by the velocity.</strong>  The second equation is less intuitive and requires some more explanation.</p>
</div>
<div class="section" id="net-forces">
<h2>Net forces<a class="headerlink" href="#net-forces" title="Permalink to this headline">¶</a></h2>
<p>Another way to describe the second equation above, for a given particle, is as follows:</p>
<p>\begin{equation}
\overrightarrow{F}_{\text{net}} = m\overrightarrow{a} = m\frac{d\overrightarrow{v}}{dt} = -\frac{dU}{d\overrightarrow{x}}
\end{equation}</p>
<p>where we have brought back the arrows to remind us which variables are vectors.  If this equation is for a single particle, all vectors would have three components corresponding to the three spatial dimensions.</p>
<p>The net force on each atom, by Newton’s second law, is equal to its acceleration times its mass.  The acceleration is equal to the time derivative of the velocity, which as we have seen is equal to the negative derivative of the internal energy function <span class="math notranslate nohighlight">\(U\)</span> with respect to the positions, <span class="math notranslate nohighlight">\(\overrightarrow{x}\)</span>.  <strong>Why is this?</strong></p>
</div>
<div class="section" id="gaining-intuition-about-du-dx">
<h2>Gaining intuition about dU/dx<a class="headerlink" href="#gaining-intuition-about-du-dx" title="Permalink to this headline">¶</a></h2>
<p>Consider the potential energy surface <span class="math notranslate nohighlight">\(U(x) = kx^2\)</span>, where <span class="math notranslate nohighlight">\(\frac{dU}{dx} = 2kx\)</span>:
<img src="https://github.com/ADicksonLab/ml4md-jb/blob/main/figures/Ham_schem1-01.png?raw=true" width="500"/></p>
<p>If we think about a marble rolling in a smooth bowl, it is intuitive that a particle resting at positive <span class="math notranslate nohighlight">\(x\)</span> will experience a force in the left-ward direction.  Connecting this to our equation above, we see this is indeed the case.  The derivative of <span class="math notranslate nohighlight">\(U\)</span> with respect to <span class="math notranslate nohighlight">\(x\)</span> is positive for <span class="math notranslate nohighlight">\(x &gt; 0\)</span>, so the net force on that particle will be in the negative direction.  Since the derivative is equal to <span class="math notranslate nohighlight">\(2kx\)</span>, we see that the higher we go, the larger this net force will be.</p>
<img src="https://github.com/ADicksonLab/ml4md-jb/blob/main/figures/Ham_schem2-01.png?raw=true" width="500"/><p>The same particle sometime later will have travelled leftward and gained some velocity in the negative direction.  As the <span class="math notranslate nohighlight">\(dU/dx\)</span> is still positive, it continues to accelerate in the negative direction.</p>
<img src="https://github.com/ADicksonLab/ml4md-jb/blob/main/figures/Ham_schem3-01.png?raw=true" width="500"/><p>As our particle reaches <span class="math notranslate nohighlight">\(x=0\)</span> is has accumulated its maximum velocity in the leftward direction.  Here <span class="math notranslate nohighlight">\(dU/dx = 0\)</span>, so it is experiencing no net force, however it continues to move rapidly.</p>
<img src="https://github.com/ADicksonLab/ml4md-jb/blob/main/figures/Ham_schem4-01.png?raw=true" width="500"/><p>As <span class="math notranslate nohighlight">\(x\)</span> goes negative our particle begins to decelerate. Here <span class="math notranslate nohighlight">\(dU/dx\)</span> is negative, so our net force is in the positive direction and our particle is gradually losing its negative velocity.</p>
<img src="https://github.com/ADicksonLab/ml4md-jb/blob/main/figures/Ham_schem5-01.png?raw=true" width="500"/><p>Eventually our particle loses momentum, the velocity reaches zero, and the particle is once again stationary with a maximum value of potential energy.</p>
</div>
<div class="section" id="integrators-numerically-solving-hamilton-s-equations">
<h2>Integrators:  Numerically solving Hamilton’s equations<a class="headerlink" href="#integrators-numerically-solving-hamilton-s-equations" title="Permalink to this headline">¶</a></h2>
<p>Now that we have equations for <span class="math notranslate nohighlight">\(dx/dt\)</span> and <span class="math notranslate nohighlight">\(dv/dt\)</span>, how do we solve them for <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(v\)</span>?  <strong>In other words, how do we actually generate our trajectories?</strong></p>
<p>This type of problem is called an <strong>initial value problem</strong> or IVP.  For simple systems (like the single particle above), one can find exact solutions.  However, for systems we are interested in these IVPs can be solved numerically.</p>
<p>A simple illustrative approach is to use <strong>Euler’s method</strong>.  Starting with the definition of <span class="math notranslate nohighlight">\(v = \frac{dx}{dt} \approx \frac{x(t+\delta t) - x(t)}{\delta t}\)</span>, we can rearrange to get:
\begin{equation}
x(t + \delta t) \approx x(t) + v\delta t
\end{equation}
where the approximation becomes exact as <span class="math notranslate nohighlight">\(\delta t \rightarrow 0\)</span>.</p>
<p>Similarly, from <span class="math notranslate nohighlight">\(a = \frac{dv}{dt} \approx \frac{v(t+\delta t) - v(t)}{\delta t}\)</span> we can get:
\begin{equation}
v(t + \delta t) \approx v(t) - \frac{1}{m}\frac{dU}{dx(t)} \delta t
\end{equation}</p>
</div>
<div class="section" id="an-example">
<h2>An example:<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>
<p>A single particle in a harmonic well:  <span class="math notranslate nohighlight">\(U(x) = \frac{1}{2} k x^2\)</span> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># initial value of x</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># initial velocity</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">100</span>     <span class="c1"># &quot;spring&quot; constant for potential energy</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># mass of particle</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>    <span class="c1"># time step</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>     <span class="c1"># number of time steps</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">force</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the force for a simple 1D, one particle system.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">total_energy</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Then let’s make a trajectory that is 1000 steps long:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="c1"># use them in update equations</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">dt</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">m</span>
    
    <span class="c1"># append values to trajectories</span>
    <span class="n">traj_x</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">traj_v</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">traj_e</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_energy</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_v</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Variable value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_e</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Total Energy&#39;)
</pre></div>
</div>
<img alt="../_images/W6_Lecture_MD-Concepts1_31_1.png" src="../_images/W6_Lecture_MD-Concepts1_31_1.png" />
</div>
</div>
<p><strong>Note: the fluctuations in total energy are due to integration errors!</strong></p>
</div>
<div class="section" id="a-better-integration-function">
<h2>A better integration function<a class="headerlink" href="#a-better-integration-function" title="Permalink to this headline">¶</a></h2>
<p>Euler’s method is a “first order” method: the global error (error at a given time) is proportional to the step size.  <strong>A commonly used integration function is called the “Velocity Verlet” algorithm</strong>, which is accurate to second order, meaning that error is proportional to the step size squared.</p>
<p>VV is a good choice of integrator as it is simple to implement, and has some beneficial stability properties compared to other higher-order integrators.</p>
<p><strong>The VV algorithm is as follows:</strong></p>
<p>Update <span class="math notranslate nohighlight">\(v\)</span> (half-way):
$<span class="math notranslate nohighlight">\(v(t + \delta t/2) = v(t) + \frac{1}{2m}\left[f(t)\right]\delta t\)</span>$</p>
<p>Use the half-updated <span class="math notranslate nohighlight">\(v\)</span> to (fully) update <span class="math notranslate nohighlight">\(x\)</span>:
$<span class="math notranslate nohighlight">\(x(t + \delta t) = x(t) + v(t + \delta t/2)\delta t\)</span>$</p>
<p>Use the updated <span class="math notranslate nohighlight">\(x\)</span> to compute new forces, apply those to fully update <span class="math notranslate nohighlight">\(v\)</span>:
$<span class="math notranslate nohighlight">\(v(t + \delta t) = v(t + \delta t/2) + \frac{1}{2m}\left[f(t + \delta t)\right]\delta t\)</span>$</p>
<p>This can be done in two steps as:</p>
<div class="math notranslate nohighlight">
\[x(t + \delta t) = x(t) + v(t)\delta t + \frac{1}{2m}f(t)\delta t^2\]</div>
<div class="math notranslate nohighlight">
\[v(t + \delta t) = v(t) + \frac{1}{2m}\left[f(t) + f(t + \delta t)\right]\delta t\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="c1"># Velocity Verlet</span>
    <span class="n">v_tmp</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">m</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">v_tmp</span><span class="o">*</span><span class="n">dt</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v_tmp</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">m</span>
    
    <span class="c1"># append values to trajectories</span>
    <span class="n">traj_x</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">traj_v</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">traj_e</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_energy</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_v</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Variable value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_e</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Total Energy&#39;)
</pre></div>
</div>
<img alt="../_images/W6_Lecture_MD-Concepts1_36_1.png" src="../_images/W6_Lecture_MD-Concepts1_36_1.png" />
</div>
</div>
</div>
<div class="section" id="on-the-reversibility-of-trajectories">
<h2>On the reversibility of trajectories<a class="headerlink" href="#on-the-reversibility-of-trajectories" title="Permalink to this headline">¶</a></h2>
<p><strong>Q: Can you integrate trajectories backwards in time?</strong></p>
<p><em>A: Absolutely!  In fact, let’s do it right now!</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj_x_rev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_v_rev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">traj_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># begin at the end of the last trajectory</span>
<span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">traj_v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># reverse the velocity!</span>

<span class="c1"># the first point of the reverse trajectory is the last point of the prior one</span>
<span class="n">traj_x_rev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">traj_v_rev</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

<span class="c1"># integrating the remainder of the N-1 points</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">v_tmp</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">m</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">v_tmp</span><span class="o">*</span><span class="n">dt</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v_tmp</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">m</span>
    
    <span class="c1"># append values to trajectories</span>
    <span class="n">traj_x_rev</span><span class="p">[</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">traj_v_rev</span><span class="p">[</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_x_rev</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;cyan&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;x (backwards)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Variable value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fd4f8109fd0&gt;
</pre></div>
</div>
<img alt="../_images/W6_Lecture_MD-Concepts1_40_1.png" src="../_images/W6_Lecture_MD-Concepts1_40_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate distance between first and last points</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Difference in positions:&quot;</span><span class="p">,</span><span class="n">traj_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">traj_x_rev</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Difference in positions: -5.218048215738236e-15
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="an-aside-on-chaos">
<h2>An aside on chaos<a class="headerlink" href="#an-aside-on-chaos" title="Permalink to this headline">¶</a></h2>
<p>In realistic systems with many atoms, it is extremely difficult for a trajectory to “retrace” itself after reversing the velocities.  This is because small differences between two trajectories become quickly amplified in <strong>chaotic systems</strong>.  You might have heard this referred to as the “butterfly effect”.</p>
<p>Molecular systems with thousands of atoms are strongly chaotic.  In fact, much simpler systems, such as the <strong>double pendulum</strong> also demonstrate the same chaotic behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports the functionality that we need to display YouTube videos in a Jupyter notebook.  </span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>

<span class="c1"># Watch this video to see some double pendulums diverge!</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;ldnEHycw40E&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<iframe
    width="640"
    height="360"
    src="https://www.youtube.com/embed/ldnEHycw40E"
    frameborder="0"
    allowfullscreen

></iframe>
</div></div>
</div>
</div>
<div class="section" id="introducing-randomness-with-langevin-dynamics">
<h2>Introducing randomness with Langevin dynamics<a class="headerlink" href="#introducing-randomness-with-langevin-dynamics" title="Permalink to this headline">¶</a></h2>
<p>Often we want to incorporate the effects of random external “noise” on a molecular system.</p>
<p>A quintessential example is that of <a class="reference external" href="https://en.wikipedia.org/wiki/Brownian_motion">Brownian motion</a>, where a larger particle experiences many small “kicks” from a sea of smaller solvent particles.</p>
<p><strong>Langevin dynamics</strong> provides a way to “tune” between completely inertial motion (no random kicks) and completely diffusive motion (velocities are instantly forgotten).  It does this by introducing two terms to the net force: <strong>a drag term</strong> that sucks energy out of the system, and <strong>a random noise term</strong> that pumps it back in as a random “kick”.</p>
<p>An algorithm for Langevin dynamics with the Velocity Verlet algorithm is as follows:</p>
<div class="math notranslate nohighlight">
\[x(t + \delta t) = x(t) + v(t)\delta t + \frac{1}{2m}f(t)\delta t^2\]</div>
<div class="math notranslate nohighlight">
\[v(t + \delta t) = v(t) + \frac{1}{2m}\left[f(t) + f(t + \delta t)\right]\delta t - \gamma v(t)\delta t + \sqrt{\frac{2 \gamma k_B T}{m}} R(t) \delta t\]</div>
<p>where <span class="math notranslate nohighlight">\(\gamma\)</span> is the friction coefficient, <span class="math notranslate nohighlight">\(k_B\)</span> is <a class="reference external" href="https://en.wikipedia.org/wiki/Boltzmann_constant">Boltzmann’s constant</a> and <span class="math notranslate nohighlight">\(T\)</span> is the temperature in Kelvin.  <span class="math notranslate nohighlight">\(R(t)\)</span> is a random number, drawn each step from a Gaussian distribution (or “normal” distribution), with a mean of zero and a width of 1.</p>
<p><strong>Let’s run some Langevin dynamics on our oscillator!</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># initial value of x</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># initial velocity</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">100</span>     <span class="c1"># &quot;spring&quot; constant for potential energy</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># mass of particle</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>    <span class="c1"># time step</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>     <span class="c1"># number of time steps</span>
<span class="n">kT</span> <span class="o">=</span> <span class="mi">1000</span>      <span class="c1"># thermal energy</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># friction</span>

<span class="n">prefac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="n">kT</span><span class="o">/</span><span class="n">m</span><span class="p">)</span>

<span class="n">traj_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">traj_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="c1"># Velocity Verlet with noise</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">m</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="n">force</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">m</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">prefac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">()</span><span class="o">*</span><span class="n">dt</span>
    
    <span class="c1"># append values to trajectories</span>
    <span class="n">traj_x</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">traj_v</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">traj_e</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_energy</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_v</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj_e</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Total Energy&#39;)
</pre></div>
</div>
<img alt="../_images/W6_Lecture_MD-Concepts1_47_1.png" src="../_images/W6_Lecture_MD-Concepts1_47_1.png" />
</div>
</div>
<p><strong>The total energy is not conserved!</strong>  Why is this?</p>
</div>
<div class="section" id="constant-temperature-or-constant-energy-but-not-both">
<h2>Constant temperature or constant energy, but not both<a class="headerlink" href="#constant-temperature-or-constant-energy-but-not-both" title="Permalink to this headline">¶</a></h2>
<p>This could begin a deep dive into concepts from <strong>statistical mechanics</strong>, but here let’s just say that you can either run with the temperature fixed and the energy fluctuating, or run with the energy fixed and the temperature fluctuating.</p>
<p>As you might have guessed from the <span class="math notranslate nohighlight">\(kT\)</span> term in the noise, Langevin dynamics is a form of <strong>thermostat</strong>.  In other words, it is an integrator that keeps our system at a constant temperature.  We will learn more about temperature and thermostats later on.</p>
<p>The fact that you can’t fix both <span class="math notranslate nohighlight">\(T\)</span> and <span class="math notranslate nohighlight">\(E\)</span> at the same time is indicative of a special relationship between the two.  They are said to be <strong>Canonically conjugate variables</strong>.  We will learn about other pairs of Canonically conjugate variables later as well.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Week-06"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../Week-05/W5_Lab_StructurePrediction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Week 05 Lab: Structure Prediction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="W6_Lab_Single-Particle-Langevin-Dynamics.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Week 06 Lab: Single Particle Langevin Dynamics</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Alex Dickson and Michael Feig<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>